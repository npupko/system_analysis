# Splitting ES into contexts
Изначально у меня была схема [Step1.pdf](./es_steps/step1.pdf)

Я выделил 4 основных контекста:
- *Hiring*
- *Warehouse*
- *Betting system*
- *Billing*

Биилинг вынес отдельно, потому что он будто бы не был связан с остальными контекстами. Там все события вызываются кроном.
Система ставок, хайринг и склад вынес по наитию. Выглядят как отдельные сущности со своими внутренними процессами.

Итог: [Step2.pdf](./es_steps/step2.pdf)

На этом этапе возник вопрос куда поместить команду слева от склада "Заказать расходники для задачи".
Начал перетаскивать цепочки, решив в случае с воркерами сгрупировать по актору. Получил *Workers Platform*.
Так же *Quality Control* вынес в отдельную систему.
Пытался представить как клиенты пользовались бы платформой (В плане UI). На основе этого разделил *Workers Platform*, *Clients Platform* и *Quality Control*

Итог: [Step3.pdf](./es_steps/step3.pdf)
[Miro](https://miro.com/app/board/uXjVMJwgTXY=/?share_link_id=88646174588)

# Data model
Начал с переноса контекстов из ES и заполнения разными entity. Вышло вот так: [svg](./data_model_steps/step1.svg)|[d2](./data_model_steps/step1.d2)

Затем добавил консьюмеров и продьюсеров с асинхронными коммуникациями. [svg](./data_model_steps/step2.svg)|[d2](./data_model_steps/step2.d2)

В результате увидел что удобнее обьеденить контексты *Workers Platform* и *Clients Platform* в один. [svg](./data_model_steps/step3.svg)|[d2](./data_model_steps/step3.d2)

Обновил ES: [Step4.pdf](./es_steps/step4.pdf)

# Realisation
Касательно реализации,я бы выбрал сервисы. В качестве стека Rails/Hanami. Kafka в качестве брокера сообщений. Postgres в качестве хранилища. Kubernetes для оркестрации.
В ES красными стрелочками пометил асинхронные коммуникации, синими - синхронные.
В модели данных синими прерывистыми - CUD-ивенты, черными - синхронные события.
Т.е. присутствуют и синхронные и асинхронные коммуникации между компонентами, между сервисами асинхронные.
Выбрал такой подход потому что представляю как с ним работать. Не имел опыта с сервисами и синхронными коммуникациями.

Global model: [svg](./global_model.svg)|[d2](./global_model.d2)

# Problems/Questions
- Очень сложно разделять на контексты. Нет уверенности что сделал это правильно. 
- Так же на схеме никак не обозначил нотификации, не совсем понимаю как их обозначить в контексте бизнес-ивентов, и не затрагивать техническую реализацию.
Для себя считаю email внешней системой, которая ловит нужные ивенты
