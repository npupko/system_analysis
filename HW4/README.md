## Изначальная система
![](attachment/cba0d2a2f39166d182112798568a8b05.png)

### Считаем Instability
![](attachment/70dd044744025e1050c3a405a8f0c00e.png)


### Фиксим и добавляем
Предположим, что у нас есть ресурсы, но нет опыта у разработчиков.
Начнём с новой функциональности, добавим производство печенек.
Из плюсов, нам не нужно самим реализовывать данную штуку, поэтому просто отправляем из склада синхронный запрос с информацией о клиенте на фабрику печенек.

![](attachment/3716b16ed492280a0e8561b8010d1de0.png)

Сервис для AuthN мы тоже уберём, потому что в ТЗ такого не было и вообще непонятно зачем мы его сделали, ведь можно авторизовать котов по отпечатку носиков автоматически.

![](attachment/727792d471a5a52b86135db251025491.png)

Далее будем выносить из CRM наш супер Matching Algorithm в отдельный сервис.
Повезло, что у нас была отдельная команда.

Так как нам оказалось нужно поменять тип базы данных на графовую, плюс нам очень важны предыдущие данные, используем Change Data Capture.
Пишем данные в брокер и реализуем (частично копируем, конечно же) логику матчинга.

![](attachment/7dd3c28abcf6f77acc632d1f073be157.png)


Далее решаем проблему с платежами. Нужно объеденить сервис платежей и CRM, плюс ко всему разделить логику зарплат воркерам и логику списаний у клиентов.
Используем старый сервис платежей, пока пишем логику для нового. Пусть начнём с сервиса выплаты воркерам. Когда он будет готов — подключаем его и роутим все запросы, связанные с зарплатами воркеров в новый сервис. Из плюсов — он у нас использует одну базу с CRM — так что коммуникации простые. 

![](attachment/2952ff9bda5321d47ee1280579636dbc.png)

Далее точно так же выносим логику для списания с клиентов и просто отключаем старый сервис Payments

![](attachment/f638c2b24d18d30a9e676e55351686c0.png)

Далее выносим систему контроля качества в отдельный сервис. Так как держать два монолита поднятыми дорого, но у нас всё бесплатно — воспользуемся Tactical Forking

![](attachment/61c198fb69f56cfa5439cb1f80214034.png)

Получается система аналогичная той, которая вышла у меня в конце третьей домашки